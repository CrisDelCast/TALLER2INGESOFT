// TALLER2INGESOFT/Jenkinsfile
pipeline {
    agent any

    environment {
        SERVICE_NAME = 'order-service'
        MAVEN_OPTS = '-Dmaven.repo.local=.m2/repository' // Cach√© de Maven en el workspace
        // ACR_CREDENTIALS_ID = 'your-acr-jenkins-credentials-id' // Comentado por ahora
        // REGISTRY_URL = 'ecommerceacr.azurecr.io' // Comentado por ahora
    }

    stages {
        stage('1. Checkout SCM') {
            steps {
                echo 'üì¶ Clonando c√≥digo fuente desde SCM...'
                checkout scm
            }
        }

        stage('2. Build & Package (Debug)') {
            steps {
                echo "üî® Compilando y empaquetando ${SERVICE_NAME} con Maven en modo debug..."
                dir("${SERVICE_NAME}") {
                    // IMPORTANTE: Redirecci√≥n para capturar todo el log de Maven
                    sh 'mvn clean package -X > maven-build-debug.log 2>&1'
                }
            }
        }
        // Las otras etapas (Tests, Docker, Deploy) se a√±adir√°n despu√©s de que esta funcione
    }

    post {
        always {
            echo 'üßπ Limpiando workspace (temporalmente deshabilitado para depuraci√≥n)...'
            // *** MUY IMPORTANTE: Comentado para que el log de depuraci√≥n no se borre ***
            // cleanWs()
        }
        success {
            echo '‚úÖ Pipeline completado exitosamente (con build debug log).'
        }
        failure {
            echo '‚ùå ¬°La pipeline fall√≥! Revisa el "maven-build-debug.log" en el workspace.'
        }
    }
}